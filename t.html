<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LoveForEm_2025 üíñ</title>
    <script
      type="module"
      src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"
    ></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Great+Vibes&display=swap");

      body {
        margin: 0;
        background: radial-gradient(circle at center, #ffe6f0, #ffcce0);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        height: 100vh;
        overflow: hidden;
        font-family: "Poppins", sans-serif;
      }

      model-viewer {
        width: 100%;
        height: 78vh;
        --poster-color: transparent;
        animation: zoomIn 2s ease-in-out;
      }

      @keyframes zoomIn {
        from {
          transform: scale(1);
          opacity: 0.8;
        }
        to {
          transform: scale(1.25);
          opacity: 1;
        }
      }

      /* üéµ Mini player */
      .music-box {
        position: absolute;
        top: 15px;
        left: 10px;
        background-color: rgba(255, 240, 245, 0.95);
        border-radius: 40px;
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 6px 15px 6px 10px;
        box-shadow: 0 4px 12px rgba(255, 105, 135, 0.3);
        z-index: 5;
      }

      .music-btn {
        background: linear-gradient(145deg, #ff8fab, #ff6f91);
        border: none;
        border-radius: 50%;
        width: 45px;
        height: 45px;
        color: white;
        font-size: 22px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
      }

      .song-name {
        font-size: 14px;
        color: #ff4f87;
        font-weight: 500;
        overflow: hidden;
        white-space: nowrap;
        max-width: 160px;
      }

      .song-name span {
        display: inline-block;
        animation: slide 10s linear infinite;
      }

      @keyframes slide {
        from {
          transform: translateX(100%);
        }
        to {
          transform: translateX(-100%);
        }
      }

      /* Buttons */
      .buttons {
        position: absolute;
        bottom: 25px;
        display: flex;
        gap: 15px;
        z-index: 3;
      }

      button {
        background-color: #ff8fab;
        border: none;
        border-radius: 30px;
        color: white;
        font-size: 15px;
        font-weight: 500;
        padding: 10px 22px;
        cursor: pointer;
        box-shadow: 0 4px 8px rgba(255, 105, 135, 0.4);
        transition: all 0.3s ease;
      }

      button:hover {
        background-color: #ff6f91;
        transform: translateY(-3px);
      }

      /* Th∆∞ */
      .letter-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 204, 224, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.6s ease;
        z-index: 10;
      }

      .letter-overlay.active {
        opacity: 1;
        pointer-events: auto;
      }

      .letter-paper {
        background: linear-gradient(180deg, #fff0f5, #ffe6ef);
        border-radius: 15px;
        box-shadow: 0 8px 25px rgba(255, 105, 135, 0.3);
        padding: 25px;
        width: 90%;
        max-width: 400px;
        font-size: 16px;
        color: #333;
        line-height: 1.6;
        text-align: justify;
        transform: translateY(50px);
        opacity: 0;
        transition: all 1s ease;
      }

      .letter-paper.show {
        transform: translateY(0);
        opacity: 1;
      }

      /* Album */
      .album {
        display: none;
        position: fixed;
        top: 10%;
        left: 0;
        width: 100%;
        height: 80%;
        background: rgba(255, 240, 245, 0.95);
        justify-content: center;
        align-items: center;
        overflow: hidden;
        z-index: 20;
      }

      .album img {
        width: 90%;
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(255, 105, 135, 0.3);
      }

      /* Box l·ªùi nh·∫Øn */
      .message-box {
        display: none;
        position: fixed;
        top: 35%;
        left: 50%;
        transform: translateX(-50%);
        background: white;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(255, 105, 135, 0.3);
        width: 85%;
        max-width: 400px;
        text-align: center;
        z-index: 30;
      }

      input {
        width: 90%;
        border: 1px solid #ffb6c1;
        border-radius: 10px;
        padding: 10px;
        outline: none;
        margin-top: 10px;
      }

      /* üíñ D√≤ng ch·ªØ cu·ªëi */
      #finalText {
        position: absolute;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        text-align: center;
        color: #ff5f87;
        font-family: "Great Vibes", cursive;
        font-size: 28px;
        font-weight: 500;
        display: none;
        text-shadow: 0 0 15px rgba(255, 100, 150, 0.5);
        animation: glow 3s ease-in-out infinite;
      }
      /* üíñ Popup Th√¥ng B√°o */
      .popup {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 200, 220, 0.6);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 100;
      }

      .popup-content {
        background: white;
        border-radius: 20px;
        box-shadow: 0 5px 15px rgba(255, 100, 150, 0.3);
        padding: 25px 30px;
        text-align: center;
        animation: popIn 0.4s ease;
        max-width: 300px;
      }

      .popup-content p {
        color: #ff4f87;
        font-weight: 500;
        margin-bottom: 15px;
        font-size: 16px;
      }

      .popup-content button {
        background: linear-gradient(145deg, #ff8fab, #ff6f91);
        border: none;
        color: white;
        padding: 10px 22px;
        border-radius: 25px;
        cursor: pointer;
        transition: 0.3s;
      }

      .popup-content button:hover {
        background: #ff6f91;
        transform: scale(1.05);
      }

      @keyframes popIn {
        from {
          transform: scale(0.9);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }
    </style>
  </head>

  <body>
    <div class="music-box">
      <button class="music-btn" id="musicBtn">üéµ</button>
      <div class="song-name">
        <span>ƒêang ph√°t: Nothing's Gonna Change My Love for You üíñ</span>
      </div>
    </div>

    <audio id="bgMusic" src="em.mp3" loop></audio>

    <model-viewer
      src="thao_traitim.glb"
      autoplay
      camera-controls
      auto-rotate
    ></model-viewer>

    <div class="buttons">
      <button id="btnRead">üíå ƒê·ªçc th∆∞ g·ª≠i em</button>
      <button id="btnAlbum" style="display: none">
        üì∏ K·ª∑ ni·ªám c·ªßa ch√∫ng ta
      </button>
    </div>

    <!-- üíå Th∆∞ -->
    <div class="letter-overlay" id="letterOverlay">
      <div class="letter-paper" id="letterPaper">
        <div class="letter-header">üíå G·ª≠i ƒë·∫øn em, Ng·ªçc Th·∫£o üíï</div>
        <p>
          C√≥ th·ªÉ em kh√¥ng bi·∫øt, nh∆∞ng m·ªói l·∫ßn anh nh√¨n th·∫•y em, tr√°i tim anh l·∫°i
          ƒë·∫≠p nhanh h∆°n m·ªôt nh·ªãp.
        </p>
        <p>
          Anh t·∫°o ra trang web n√†y ch·ªâ ƒë·ªÉ n√≥i r·∫±ng ‚Äî
          <b>Em ch√≠nh l√† ƒëi·ªÅu ng·ªçt ng√†o nh·∫•t m√† anh t·ª´ng c√≥ üíñ</b>
        </p>
        <p>
          Ch√∫c em lu√¥n vui v·∫ª, v√† h√£y nh·ªõ r·∫±ng ‚Äî
          <b>Anh lu√¥n ·ªü ƒë√¢y, y√™u th∆∞∆°ng em m√£i m√£i üíû</b>
        </p>
        <button class="close-btn" onclick="nextToAlbum()">ƒê√≥ng th∆∞</button>
      </div>
    </div>

    <!-- üì∏ Album -->
    <div class="album" id="album">
      <img id="albumImg" src="img1.jpg" alt="K·ª∑ ni·ªám" />
    </div>

    <!-- üí¨ Nh·∫Øn g·ª≠i -->
    <div class="message-box" id="messageBox">
      <p>üí¨ Em c√≥ mu·ªën g·ª≠i g√¨ ƒë·∫øn anh kh√¥ng?</p>
      <input id="messageInput" placeholder="Vi·∫øt ƒëi·ªÅu em mu·ªën n√≥i..." />
      <button onclick="sendMessage()">G·ª≠i</button>
    </div>

    <div id="finalText">üíñ Anh y√™u em üíñ</div>

    <!-- üíå Popup th√¥ng b√°o -->
    <div id="popupMessage" class="popup">
      <div class="popup-content">
        <p id="popupText"></p>
        <button onclick="closePopup()">ƒê√≥ng</button>
      </div>
    </div>
    <script>
      const musicBtn = document.getElementById("musicBtn");
      const bgMusic = document.getElementById("bgMusic");
      const btnRead = document.getElementById("btnRead");
      const btnAlbum = document.getElementById("btnAlbum");
      const letterOverlay = document.getElementById("letterOverlay");
      const letterPaper = document.getElementById("letterPaper");
      const album = document.getElementById("album");
      const albumImg = document.getElementById("albumImg");
      const messageBox = document.getElementById("messageBox");
      const finalText = document.getElementById("finalText");

      let musicPlaying = false;
      let currentImg = 1;

      // üéµ Music
      musicBtn.onclick = () => {
        musicPlaying = !musicPlaying;
        if (musicPlaying) {
          bgMusic.play();
          musicBtn.textContent = "‚è∏Ô∏è";
        } else {
          bgMusic.pause();
          musicBtn.textContent = "üéµ";
        }
      };
      function showPopup(text) {
        const popup = document.getElementById("popupMessage");
        const popupText = document.getElementById("popupText");
        popupText.textContent = text;
        popup.style.display = "flex";
      }

      function closePopup() {
        document.getElementById("popupMessage").style.display = "none";
      }

      // üíå Th∆∞
      btnRead.onclick = () => {
        letterOverlay.classList.add("active");
        setTimeout(() => {
          letterPaper.classList.add("show");
          bgMusic.play();
          musicPlaying = true;
          musicBtn.textContent = "‚è∏Ô∏è";
        }, 300);
      };

      function nextToAlbum() {
        letterOverlay.classList.remove("active");
        btnRead.style.display = "none";
        setTimeout(() => (btnAlbum.style.display = "block"), 800);
      }

      // üì∏ Album vu·ªët tr√°i
      btnAlbum.onclick = () => {
        album.style.display = "flex";
        albumImg.src = "img1.jpg";
        currentImg = 1;
        document.body.addEventListener("touchstart", swipeHandler, false);
      };

      function swipeHandler() {
        currentImg++;
        if (currentImg > 3) {
          album.style.display = "none";
          messageBox.style.display = "block";
          document.body.removeEventListener("touchstart", swipeHandler, false);
        } else {
          albumImg.src = `img${currentImg}.jpg`;
        }
      }

      // üí¨ L∆∞u l·ªùi nh·∫Øn v√†o MongoDB qua backend
      async function sendMessage() {
        const msg = document.getElementById("messageInput").value.trim();
        if (!msg) return showPopup("üíå Em ch∆∞a vi·∫øt g√¨ c·∫£ üíï");

        try {
          await fetch("https://heart-hsvb.onrender.com/api/messages", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: msg }),
          });
          messageBox.style.display = "none";
          finalText.style.display = "block";
          showPopup("üíå L·ªùi nh·∫Øn c·ªßa em ƒë√£ ƒë∆∞·ª£c l∆∞u l·∫°i r·ªìi üíñ");
          btnAlbum.style.display = "none";
        } catch (err) {
          alert("Kh√¥ng g·ª≠i ƒë∆∞·ª£c tin nh·∫Øn üò¢");
          console.error(err);
        }
      }
    </script>
  </body>
</html>
